import groovy.json.JsonSlurper
pipeline {
    agent any
    stages {
        stage('pull recipeints') {
            steps {
                script {
                    def jss = new JsonSlurper()
                    def orecp = jss.parseText("${recipients}");
                    Map mrecp = (Map) orecp;
                    mrecp.each { key, value ->
                    println key;
                    println value;
                    }
                }
            }
        }
        stage('send test mails') {
            steps {
                script{
                    mrecp.each { key, value ->
                        mail body: "Dear ${key} testy testy testington",
                        subject: 'test email from Jenkins',
                        to: "${value}"
                    }
                }
            }
        }
    }
}